pipeline {
    agent any
	
	environment {
		PATH = "C:\\WINDOWS\\SYSTEM32;C:\\Users\\SSLTP11522\\AppData\\Local\\Programs\\Python\\Python311;C:\\Program Files\\Git\\bin\\git.exe"
	}
	
    stages {
        		
		stage("Checkout Code") {
			steps {
				script {
					git branch: "master",
                    credentialsId: 'jenkins-git-whook',
                    url: 'https://github.com/sekars3/Python-integration.git'
				}
			}
		}
		
        stage('Setup parameters') {
            steps {
                script { 
                    properties([
                        parameters([
							string(name: 'USER_NAME', description: 'Enter the user name', trim: true),
							password(name: 'PASSWORD', description: 'Enter the password'),
							string(name: 'PLAN_NAME', description: 'Enter the name of the Execution Plan', trim: true),
							string(name: 'PLAN_DESC', description: 'Enter the description of the Execution Plan', trim: true),
                            choice(name: 'PAUSE_ON_ERROR', choices: ['false', 'true']),
						
                            choice(name: 'SCHEDULE_CHECK', choices: ['false', 'true']),
                            string(name: 'SCHEDULE_EXPR', description: 'Enter the schedule expression', trim: true),
						
                            text(name: 'YAML_INPUT', description: 'Enter the YAML input for the tasks from the Root level')
						])
					])	
                }
            }
        }
		
		stage('write') {
			steps {
               script {
					writeFile(file: 'plan_details.txt', text: "${params.YAML_INPUT}")
               }
            }
        }
		
		stage('build') {
			steps {
			    script {
			        def ws = "${env.WORKSPACE}"
				    echo "Calling python code"
				    bat "python importExecutionPlan.py \"${env.WORKSPACE}\" plan_details.txt \"${params.USER_NAME}\" \"${params.PASSWORD}\" \"${params.PLAN_NAME}\" \"${params.PLAN_DESC}\" \"${params.PAUSE_ON_ERROR}\" \"${params.SCHEDULE_CHECK}\" \"${params.SCHEDULE_EXPR}\""
			    }
			}
		}
	}
}