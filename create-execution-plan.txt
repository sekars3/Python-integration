pipeline {
    agent any
	
	environment {
		PATH = "C:\\WINDOWS\\SYSTEM32;C:\\Users\\SSLTP11522\\AppData\\Local\\Programs\\Python\\Python311;C:\\Program Files\\Git\\bin\\git.exe"
	}
	
    stages {
        		
		stage("Checkout Code") {
			steps {
				script {
					git branch: "master",
                    credentialsId: 'jenkins-git-whook',
                    url: 'https://github.com/sekars3/Python-integration.git'
				}
			}
		}
		
        stage('Setup parameters') {
            steps {
                script { 
                    properties([
                        parameters([
							string(
                                description: 'Enter the name of the Execution Plan', 
                                name: 'PLAN_NAME', 
                                trim: true
                            ),
							string(
                                description: 'Enter the description of the Execution Plan', 
                                name: 'PLAN_DESC', 
                                trim: true
                            ),
                            choice(
                                choices: ['false', 'true'], 
                                name: 'PAUSE_ON_ERROR'
                            ),
                            choice(
                                choices: ['false', 'true'], 
                                name: 'SCHEDULE_CHECK'
                            ),
                            string(
                                description: 'Enter the schedule expression', 
                                name: 'SCHEDULE_EXPR', 
                                trim: true
                            ),
                            text(
								description: 'Enter the YAML input for the tasks from the Root level',
                                name: 'YAML_INPUT'
                            )
						])
					])	
                }
            }
        }
		
		stage('write') {
			steps {
               script {
					writeFile(file: 'plan_details.txt', text: "${params.YAML_INPUT}")
               }
            }
        }
		
		stage('build') {
			steps {
			    script {
			        def ws = "${env.WORKSPACE}"
				    echo "Calling python code"
				    bat '''python importExecutionPlan.py 
						"${env.WORKSPACE}"
						plan_details.txt
						"${params.PLAN_NAME}"
						"${params.PLAN_DESC}"
						"${params.PAUSE_ON_ERROR}"
						"${params.SCHEDULE_CHECK}"
						"${params.SCHEDULE_EXPR}"
					'''
			    }
			}
		}
	}
}